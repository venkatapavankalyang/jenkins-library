def PIPELINE_PROPS
pipeline {
   agent any
   libraries {
       lib('jenkins-library')
   }
      parameters {
      choice(name: 'ModuleType', choices: ['All' , 'Maven_Build' , 'Gradle_Build'])
      string(name: 'Branch', defaultValue: 'main')
   }
     stages {
        stage ("Maven_BuilD") {
           when {
               expression { ModuleType == 'All' || ModuleType == 'Maven_Build' }
           }
           steps {
              script {
                PIPELINE_PROPS = readProperties file: 'properties/pipeline.properties'
                def str = "$ModuleType"
                  if (str.contains("Maven_Build")) {
                    dir("${WORKSPACE}/maven-project") {
                       gitCheckOut("${PIPELINE_PROPS["MAVEN_URL"]}", "$params.Branch")
                       sh ("${PIPELINE_PROPS["MAVEN_BUILD_COMMAND"]}")
                       withSonarQubeEnv("SonarQube-7.5") {
                         sh ("${PIPELINE_PROPS["SONAR_MAVEN_COMMAND"]}")
                       }
                    }
                 }
              }
           }
        }
        stage ("Gradle_BuilD") {
            when {
                expression { ModuleType == 'All' || ModuleType == 'Gradle_Build' }
            }
            steps {
               script {
                  PIPELINE_PROPS = readProperties file: 'properties/pipeline.properties'
                  else if (str.contains("Gradle_Build")) {
                    dir("${WORKSPACE}/sonar-project") {
                        gitCheckOut("${PIPELINE_PROPS["GRADLE_URL"]}", "$params.Branch")
                        sh ("${PIPELINE_PROPS["SONAR_BUILD_COMMAND"]}")
                        withSonarQubeEnv("SonarQube-7.5") {
                         sh ("${PIPELINE_PROPS["SONAR_GRADLE_COMMAND"]}")
                        }
                    }
                  }
               }
            }
        }
     }
   }